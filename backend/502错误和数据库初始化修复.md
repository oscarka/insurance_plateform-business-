# 502é”™è¯¯å’Œæ•°æ®åº“åˆå§‹åŒ–ä¿®å¤

## âœ… å½“å‰çŠ¶æ€

- âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
- âŒ 502é”™è¯¯ï¼ˆåº”ç”¨æ— æ³•å“åº”ï¼‰
- âŒ æ•°æ®åº“ä¸­æ²¡æœ‰è¡¨ï¼ˆéœ€è¦åˆå§‹åŒ–ï¼‰

## ğŸ” é—®é¢˜åˆ†æ

### é—®é¢˜1ï¼š502é”™è¯¯

ä»æ—¥å¿—çœ‹ï¼ŒæœåŠ¡å™¨è¿è¡Œåœ¨ `http://localhost:8080`ï¼Œä½†è¿”å›502é”™è¯¯ã€‚

**å¯èƒ½åŸå› **ï¼š
1. **æœåŠ¡å™¨åªç›‘å¬äº† `localhost`**ï¼šRailwayéœ€è¦æœåŠ¡å™¨ç›‘å¬ `0.0.0.0` æ‰èƒ½ä»å¤–éƒ¨è®¿é—®
2. **ç«¯å£é…ç½®é—®é¢˜**ï¼šRailwayåˆ†é…çš„ç«¯å£å¯èƒ½ä¸æ˜¯8080

### é—®é¢˜2ï¼šæ•°æ®åº“æ²¡æœ‰è¡¨

æ•°æ®åº“è¿æ¥æˆåŠŸï¼Œä½†è¿˜æ²¡æœ‰åˆå§‹åŒ–è¡¨ç»“æ„ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤1ï¼šä¿®æ”¹æœåŠ¡å™¨ç›‘å¬åœ°å€

ä¿®æ”¹ `server.js`ï¼Œè®©æœåŠ¡å™¨ç›‘å¬ `0.0.0.0` è€Œä¸æ˜¯ `localhost`ï¼š

```javascript
app.listen(PORT, '0.0.0.0', () => {
  console.log(`ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://0.0.0.0:${PORT}`);
  console.log(`ğŸ“ APIæ–‡æ¡£: http://0.0.0.0:${PORT}/api`);
  console.log(`ğŸ’š å¥åº·æ£€æŸ¥: http://0.0.0.0:${PORT}/health`);
});
```

### ä¿®å¤2ï¼šåˆå§‹åŒ–æ•°æ®åº“è¡¨

ä½¿ç”¨ Railway CLI æˆ–ç½‘é¡µç•Œé¢æ‰§è¡Œ SQL æ–‡ä»¶ã€‚

## ğŸ“‹ å®Œæ•´ä¿®å¤æ­¥éª¤

### æ­¥éª¤1ï¼šä¿®å¤æœåŠ¡å™¨ç›‘å¬åœ°å€

1. **ç¼–è¾‘ `backend/server.js`**ï¼š
   - æ‰¾åˆ° `app.listen(PORT, ...)`
   - ä¿®æ”¹ä¸ºï¼š`app.listen(PORT, '0.0.0.0', ...)`

2. **æäº¤å¹¶æ¨é€**ï¼š
   ```bash
   cd /Users/cc/insuranceplateform
   git add backend/server.js
   git commit -m "ä¿®å¤Railwayéƒ¨ç½²ï¼šæœåŠ¡å™¨ç›‘å¬0.0.0.0"
   git push origin main
   ```

3. **ç­‰å¾…Railwayè‡ªåŠ¨éƒ¨ç½²**

### æ­¥éª¤2ï¼šåˆå§‹åŒ–æ•°æ®åº“è¡¨

**æ–¹æ³•Aï¼šä½¿ç”¨Railwayç½‘é¡µç•Œé¢ï¼ˆæ¨èï¼‰**

1. **è¿›å…¥Railwayé¡¹ç›®**
   - è®¿é—® https://railway.app
   - è¿›å…¥ä½ çš„é¡¹ç›®

2. **æ‰“å¼€MySQLæœåŠ¡**
   - ç‚¹å‡» MySQL æœåŠ¡
   - ç‚¹å‡» "Query" æ ‡ç­¾

3. **æ‰§è¡ŒSQLæ–‡ä»¶**
   - æ‰“å¼€ `database_schema.sql` æ–‡ä»¶
   - å¤åˆ¶å…¨éƒ¨å†…å®¹
   - ç²˜è´´åˆ°Queryç¼–è¾‘å™¨ä¸­
   - ç‚¹å‡» "Run" æ‰§è¡Œ

4. **æ‰§è¡Œå…¶ä»–SQLæ–‡ä»¶**ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š
   - `database_create_regions_table.sql`
   - `database_extend_special_agreements.sql`
   - `database_migration_task1-12.sql`

**æ–¹æ³•Bï¼šä½¿ç”¨Railway CLI**

```bash
# 1. é“¾æ¥åˆ°MySQLæœåŠ¡
cd /Users/cc/insuranceplateform
railway link  # é€‰æ‹© MySQL æœåŠ¡

# 2. æ‰§è¡ŒSQLæ–‡ä»¶
railway run mysql < database_schema.sql
railway run mysql < database_create_regions_table.sql
railway run mysql < database_extend_special_agreements.sql
railway run mysql < database_migration_task1-12.sql
```

**æ–¹æ³•Cï¼šä½¿ç”¨æœ¬åœ°MySQLå®¢æˆ·ç«¯è¿æ¥**

ä½¿ç”¨MySQLçš„å…¬å…±è¿æ¥å­—ç¬¦ä¸²ï¼š
```
mysql://root:pKlRaIcmqMwnSxuWUkvqDmlbbOnZWpay@tramway.proxy.rlwy.net:35047/railway
```

ç„¶åæ‰§è¡ŒSQLæ–‡ä»¶ã€‚

## ğŸ” éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥502é”™è¯¯æ˜¯å¦ä¿®å¤

ä¿®å¤åï¼Œè®¿é—®ï¼š
- `https://insuranceplateform-business-production.up.railway.app/health`
- åº”è¯¥è¿”å›ï¼š`{"status":"ok"}`

### 2. æ£€æŸ¥æ•°æ®åº“è¡¨

è¿æ¥MySQLåï¼Œæ‰§è¡Œï¼š
```sql
SHOW TABLES;
```

åº”è¯¥èƒ½çœ‹åˆ°ä½ çš„è¡¨ï¼Œä¾‹å¦‚ï¼š
- `insurance_companies`
- `insurance_products`
- `insurance_plans`
- `applications`
- ç­‰ç­‰

### 3. æ£€æŸ¥APIæ˜¯å¦æ­£å¸¸

è®¿é—®ï¼š
- `https://insuranceplateform-business-production.up.railway.app/api/products`
- åº”è¯¥è¿”å›äº§å“åˆ—è¡¨

## ğŸ› å¦‚æœä»ç„¶502é”™è¯¯

### æ£€æŸ¥1ï¼šæŸ¥çœ‹å®Œæ•´æ—¥å¿—

```bash
railway link  # é“¾æ¥åˆ° Web Service
railway logs
```

æŸ¥çœ‹æ˜¯å¦æœ‰å…¶ä»–é”™è¯¯ä¿¡æ¯ã€‚

### æ£€æŸ¥2ï¼šç¡®è®¤ç«¯å£é…ç½®

åœ¨æ—¥å¿—ä¸­ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://0.0.0.0:8080
```

è€Œä¸æ˜¯ï¼š
```
ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080
```

### æ£€æŸ¥3ï¼šæ£€æŸ¥Railwayåˆ†é…çš„å®é™…ç«¯å£

Railwayå¯èƒ½ä¼šåˆ†é…ä¸åŒçš„ç«¯å£ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š
```bash
railway variables | grep PORT
```

---

**ä¿®å¤ç›‘å¬åœ°å€åï¼Œ502é”™è¯¯åº”è¯¥ä¼šè§£å†³ï¼ç„¶ååˆå§‹åŒ–æ•°æ®åº“è¡¨å³å¯ã€‚**
