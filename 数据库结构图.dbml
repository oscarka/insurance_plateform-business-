// 数据库结构图 - dbdiagram.io 格式
// 访问 https://dbdiagram.io 导入此文件即可查看可视化图表

// 核心业务表
Table companies {
  company_id bigint [pk, increment]
  company_name varchar(200)
  credit_code varchar(50) [unique]
  province varchar(50)
  city varchar(50)
  district varchar(50)
  address varchar(500)
  industry varchar(100)
  contact_name varchar(50)
  contact_phone varchar(20)
  contact_email varchar(100)
  business_license_url varchar(500)
  risk_level varchar(20)
  risk_query_time datetime
  status varchar(20)
  created_at datetime
  updated_at datetime
}

Table insurance_products {
  product_id bigint [pk, increment]
  insurance_company_code varchar(50)
  product_code varchar(50) [unique]
  product_name varchar(200)
  registration_no varchar(100)
  registration_name varchar(200)
  product_type varchar(50)
  status varchar(20)
  effective_date date
  expiry_date date
  description text
  created_at datetime
  updated_at datetime
}

Table insurance_liabilities {
  liability_id bigint [pk, increment]
  liability_code varchar(50) [unique]
  liability_name varchar(100)
  liability_type varchar(50)
  unit_type varchar(20)
  description text
  status varchar(20)
  created_at datetime
  updated_at datetime
}

Table product_liabilities {
  id bigint [pk, increment]
  product_id bigint [ref: > insurance_products.product_id]
  liability_id bigint [ref: > insurance_liabilities.liability_id]
  is_required boolean
  coverage_options text
  default_coverage varchar(50)
  min_coverage varchar(50)
  max_coverage varchar(50)
  unit varchar(20)
  display_order int
  status varchar(20)
  created_at datetime
  updated_at datetime
}

Table product_plan_templates {
  template_id bigint [pk, increment]
  product_id bigint [ref: > insurance_products.product_id]
  template_code varchar(50)
  template_name varchar(100)
  job_class_range varchar(50)
  duration_options text
  payment_type varchar(50)
  description text
  status varchar(20)
  created_at datetime
  updated_at datetime
}

Table insurance_plans {
  plan_id bigint [pk, increment]
  plan_name varchar(100)
  job_class varchar(20)
  duration varchar(20)
  payment_type varchar(50)
  base_premium decimal(10,2)
  created_at datetime
  updated_at datetime
}

Table plan_liabilities {
  id bigint [pk, increment]
  plan_id bigint [ref: > insurance_plans.plan_id]
  liability_id bigint [ref: > insurance_liabilities.liability_id]
  coverage_amount varchar(50)
  coverage_value decimal(12,2)
  unit varchar(20)
  is_selected boolean
  created_at datetime
}

Table applications {
  application_id bigint [pk, increment]
  application_no varchar(50) [unique]
  company_id bigint [ref: > companies.company_id]
  product_name varchar(200)
  product_code varchar(50)
  total_premium decimal(12,2)
  insured_count int
  effective_date date
  expiry_date date
  status varchar(20)
  draft_data text
  insurance_company varchar(100)
  insurance_company_code varchar(50)
  submitted_at datetime
  underwritten_at datetime
  created_at datetime
  updated_at datetime
}

Table application_plans {
  id bigint [pk, increment]
  application_id bigint [ref: > applications.application_id]
  plan_id bigint [ref: > insurance_plans.plan_id]
  insured_count int
  plan_premium decimal(10,2)
  created_at datetime
}

Table insured_persons {
  person_id bigint [pk, increment]
  application_id bigint [ref: > applications.application_id]
  plan_id bigint [ref: > insurance_plans.plan_id]
  name varchar(50)
  id_type varchar(20)
  id_number varchar(50)
  gender varchar(10)
  birth_date date
  phone varchar(20)
  job_code varchar(50)
  job_category varchar(20)
  job_name varchar(100)
  individual_premium decimal(10,2)
  status varchar(20)
  effective_date date
  expiry_date date
  created_at datetime
  updated_at datetime
}

Table policies {
  policy_id bigint [pk, increment]
  policy_no varchar(50) [unique]
  application_id bigint [ref: > applications.application_id]
  company_id bigint [ref: > companies.company_id]
  product_name varchar(200)
  product_code varchar(50)
  total_premium decimal(12,2)
  insured_count int
  effective_date date
  expiry_date date
  status varchar(20)
  insurance_company varchar(100)
  policy_file_url varchar(500)
  issued_at datetime
  created_at datetime
  updated_at datetime
}

Table endorsements {
  endorsement_id bigint [pk, increment]
  endorsement_no varchar(50)
  policy_id bigint [ref: > policies.policy_id]
  endorsement_type varchar(20)
  add_count int
  remove_count int
  replace_count int
  premium_change decimal(10,2)
  reason varchar(500)
  status varchar(20)
  effective_date date
  submitted_at datetime
  approved_at datetime
  created_at datetime
  updated_at datetime
}

Table endorsement_persons {
  id bigint [pk, increment]
  endorsement_id bigint [ref: > endorsements.endorsement_id]
  operation_type varchar(20)
  old_person_id bigint
  new_person_id bigint
  person_data text
  created_at datetime
}

Table renewals {
  renewal_id bigint [pk, increment]
  renewal_no varchar(50)
  original_policy_id bigint [ref: > policies.policy_id]
  new_policy_id bigint [ref: > policies.policy_id]
  company_id bigint [ref: > companies.company_id]
  renewal_premium decimal(12,2)
  insured_count int
  effective_date date
  expiry_date date
  status varchar(20)
  submitted_at datetime
  created_at datetime
  updated_at datetime
}

Table invoices {
  invoice_id bigint [pk, increment]
  invoice_no varchar(50)
  policy_id bigint [ref: > policies.policy_id]
  company_id bigint [ref: > companies.company_id]
  invoice_type varchar(20)
  invoice_amount decimal(12,2)
  tax_amount decimal(12,2)
  recipient_name varchar(50)
  recipient_phone varchar(20)
  recipient_email varchar(100)
  recipient_address varchar(500)
  status varchar(20)
  invoice_file_url varchar(500)
  applied_at datetime
  issued_at datetime
  created_at datetime
  updated_at datetime
}

Table receipts {
  receipt_id bigint [pk, increment]
  receipt_no varchar(50)
  policy_id bigint [ref: > policies.policy_id]
  company_id bigint [ref: > companies.company_id]
  receipt_type varchar(20)
  signer_name varchar(50)
  signer_phone varchar(20)
  signed_at datetime
  status varchar(20)
  receipt_file_url varchar(500)
  created_at datetime
  updated_at datetime
}

// 接口对接表
Table channels {
  channel_id bigint [pk, increment]
  channel_code varchar(50) [unique]
  channel_name varchar(100)
  insurance_company_code varchar(50)
  api_base_url varchar(200)
  api_version varchar(20)
  app_id varchar(100)
  app_secret varchar(200)
  environment varchar(20)
  status varchar(20)
  description text
  created_at datetime
  updated_at datetime
}

Table api_field_mappings {
  mapping_id bigint [pk, increment]
  channel_id bigint [ref: > channels.channel_id]
  api_name varchar(100)
  system_field varchar(100)
  api_field varchar(100)
  field_type varchar(50)
  format_rule varchar(200)
  default_value varchar(200)
  is_required boolean
  validation_rule text
  created_at datetime
  updated_at datetime
}

Table underwriting_intercept_rules {
  rule_id bigint [pk, increment]
  channel_id bigint [ref: > channels.channel_id]
  rule_name varchar(100)
  rule_type varchar(50)
  check_field varchar(100)
  check_operator varchar(20)
  check_value varchar(200)
  error_code varchar(50)
  error_message varchar(500)
  priority int
  status varchar(20)
  created_at datetime
  updated_at datetime
}

Table data_validation_rules {
  validation_id bigint [pk, increment]
  field_name varchar(100)
  field_type varchar(50)
  validation_type varchar(50)
  validation_rule text
  error_message varchar(500)
  is_required boolean
  min_length int
  max_length int
  min_value decimal(10,2)
  max_value decimal(10,2)
  status varchar(20)
  created_at datetime
  updated_at datetime
}

Table insurance_api_tasks {
  task_id bigint [pk, increment]
  task_type varchar(50)
  insurance_company varchar(100)
  business_id varchar(50)
  request_data text
  response_data text
  status varchar(20)
  retry_count int
  max_retry int
  error_message text
  scheduled_at datetime
  started_at datetime
  completed_at datetime
  created_at datetime
  updated_at datetime
}

Table insurance_api_logs {
  log_id bigint [pk, increment]
  insurance_company varchar(100)
  api_name varchar(100)
  api_url varchar(500)
  request_method varchar(10)
  request_headers text
  request_body text
  response_status int
  response_body text
  error_message text
  execution_time int
  business_id varchar(50)
  business_type varchar(50)
  created_at datetime
}

Table insurance_api_configs {
  config_id bigint [pk, increment]
  insurance_company varchar(100)
  company_code varchar(50)
  api_base_url varchar(200)
  api_version varchar(20)
  app_id varchar(100)
  app_secret varchar(200)
  environment varchar(20)
  status varchar(20)
  created_at datetime
  updated_at datetime
}

Table premium_rates {
  rate_id bigint [pk, increment]
  product_id bigint [ref: > insurance_products.product_id]
  liability_id bigint [ref: > insurance_liabilities.liability_id]
  job_class varchar(20)
  coverage_amount varchar(50)
  base_rate decimal(10,4)
  rate_factor decimal(10,4)
  min_premium decimal(10,2)
  max_premium decimal(10,2)
  effective_date date
  expiry_date date
  status varchar(20)
  created_at datetime
  updated_at datetime
}

// 系统管理表
Table users {
  user_id bigint [pk, increment]
  username varchar(50) [unique]
  password_hash varchar(200)
  phone varchar(20)
  email varchar(100)
  role varchar(20)
  status varchar(20)
  last_login_at datetime
  created_at datetime
  updated_at datetime
}

Table operation_logs {
  log_id bigint [pk, increment]
  user_id bigint [ref: > users.user_id]
  operation_type varchar(50)
  business_id varchar(50)
  operation_desc varchar(500)
  ip_address varchar(50)
  user_agent varchar(500)
  created_at datetime
}

