# 产品方案后台配置系统设计

## 一、系统概述

### 1.1 设计目标

设计一个方便的后台配置系统，用于：
- **配置保司信息**：添加和管理对接的保险公司
- **配置保司责任**：为每个保司配置责任类型
- **配置产品**：为每个保司配置产品信息
- **配置方案**：为每个产品配置方案
- **配置方案责任**：为每个方案配置责任和保额选项
- **配置费率**：配置费率信息
- **配置接口对接**：配置保司接口信息

### 1.2 核心特点

1. **层级化管理**：保司 → 产品 → 方案 → 责任，清晰的层级关系
2. **批量导入**：支持通过配置文件批量导入
3. **可视化配置**：通过界面配置，无需写代码
4. **配置验证**：配置时自动验证数据完整性
5. **配置预览**：配置后可以预览效果

---

## 二、系统功能模块

### 2.1 保司管理模块

**功能**：
- 添加保司
- 编辑保司信息
- 启用/禁用保司
- 查看保司下的产品和责任

**界面设计**：
```
保司列表页
├── 保司列表（表格）
│   ├── 保司代码
│   ├── 保司名称
│   ├── 状态
│   └── 操作（编辑/禁用/查看详情）
└── 添加保司按钮

保司详情页
├── 基本信息
│   ├── 保司代码
│   ├── 保司名称
│   ├── 联系人信息
│   └── 状态
├── 责任列表（该保司下的所有责任）
└── 产品列表（该保司下的所有产品）
```

---

### 2.2 责任管理模块

**功能**：
- 为保司添加责任
- 编辑责任信息
- 启用/禁用责任
- 批量导入责任（通过配置文件）

**界面设计**：
```
责任列表页（按保司筛选）
├── 保司选择器
└── 责任列表（表格）
    ├── 责任代码
    ├── 责任名称
    ├── 责任类型
    ├── 单位类型
    └── 操作（编辑/禁用）

责任编辑页
├── 基本信息
│   ├── 责任代码
│   ├── 责任名称
│   ├── 责任类型（下拉选择）
│   ├── 单位类型（下拉选择）
│   └── 责任描述
└── 保存按钮
```

---

### 2.3 产品管理模块

**功能**：
- 为保司添加产品
- 编辑产品信息
- 启用/禁用产品
- 查看产品下的方案
- 批量导入产品（通过配置文件）

**界面设计**：
```
产品列表页（按保司筛选）
├── 保司选择器
└── 产品列表（表格）
    ├── 产品代码
    ├── 产品名称
    ├── 产品类型
    ├── 注册号
    ├── 状态
    └── 操作（编辑/禁用/查看方案）

产品编辑页
├── 基本信息
│   ├── 保司（下拉选择，不可编辑）
│   ├── 产品代码
│   ├── 产品名称
│   ├── 产品类型（下拉选择）
│   ├── 注册号
│   ├── 注册名称
│   ├── 生效日期
│   ├── 失效日期
│   └── 产品描述
└── 保存按钮

产品详情页
├── 产品基本信息
└── 方案列表
    └── 方案管理（跳转到方案管理页面）
```

---

### 2.4 方案管理模块

**功能**：
- 为产品添加方案
- 编辑方案信息
- 启用/禁用方案
- 查看方案下的责任配置
- 批量导入方案（通过配置文件）

**界面设计**：
```
方案列表页（按产品筛选）
├── 保司选择器
├── 产品选择器
└── 方案列表（表格）
    ├── 方案代码
    ├── 方案名称
    ├── 职业类别范围
    ├── 保障时间选项
    ├── 状态
    └── 操作（编辑/禁用/配置责任）

方案编辑页
├── 基本信息
│   ├── 保司（显示，不可编辑）
│   ├── 产品（下拉选择，不可编辑）
│   ├── 方案代码
│   ├── 方案名称
│   ├── 职业类别范围（多选或输入）
│   ├── 保障时间选项（JSON编辑器或可视化配置）
│   ├── 缴费方式
│   └── 方案描述
└── 保存按钮

方案详情页
├── 方案基本信息
└── 责任配置列表
    └── 责任配置管理（跳转到责任配置页面）
```

---

### 2.5 方案责任配置模块（核心功能）

**功能**：
- 为方案添加责任
- 配置每个责任的保额选项
- 设置责任是否必选
- 设置默认保额
- 设置显示顺序

**界面设计**：
```
方案责任配置页
├── 方案信息（只读）
│   ├── 保司：利宝保险
│   ├── 产品：雇主责任险A
│   └── 方案：方案一
│
├── 责任配置列表
│   └── 表格显示
│       ├── 责任名称
│       ├── 是否必选（开关）
│       ├── 保额选项（JSON格式显示，可编辑）
│       ├── 默认保额
│       ├── 单位
│       ├── 显示顺序
│       └── 操作（编辑/删除）
│
├── 添加责任按钮
│   └── 弹出选择器：从保司责任列表中选择
│
└── 保存按钮

责任配置编辑弹窗
├── 责任选择（下拉选择，从保司责任列表中选择）
├── 是否必选（开关）
├── 保额选项配置
│   ├── 选项类型（固定值/范围/自定义）
│   └── 选项值（JSON编辑器或可视化配置）
│       └── 示例：["10万","30万","50万","80万","100万"]
├── 默认保额（下拉选择，从保额选项中选）
├── 最小保额（可选）
├── 最大保额（可选）
├── 单位（下拉选择：元/天/比例等）
└── 显示顺序（数字输入）
```

---

### 2.6 费率配置模块

**功能**：
- 配置费率信息
- 按产品、责任、职业类别、保额配置费率
- 批量导入费率（通过配置文件）
- 费率版本管理

**界面设计**：
```
费率列表页（多条件筛选）
├── 保司选择器
├── 产品选择器
├── 责任选择器
├── 职业类别选择器
└── 费率列表（表格）
    ├── 产品名称
    ├── 责任名称
    ├── 职业类别
    ├── 保额
    ├── 基础费率
    ├── 费率系数
    ├── 生效日期
    └── 操作（编辑/禁用）

费率编辑页
├── 基本信息
│   ├── 产品（下拉选择）
│   ├── 责任（下拉选择）
│   ├── 职业类别（下拉选择）
│   ├── 保额（输入）
│   ├── 基础费率（数字输入）
│   ├── 费率系数（数字输入）
│   ├── 最低保费（可选）
│   ├── 最高保费（可选）
│   ├── 生效日期
│   └── 失效日期（可选）
└── 保存按钮
```

---

### 2.7 接口配置模块

**功能**：
- 配置保司接口信息
- 配置字段映射
- 配置拦截规则
- 配置数据校验规则
- 通过配置文件导入

**界面设计**：
```
接口配置列表页
├── 保司选择器
└── 接口配置列表（表格）
    ├── 保司代码
    ├── 渠道代码
    ├── 接口地址
    ├── 环境（测试/生产）
    ├── 状态
    └── 操作（编辑/禁用/查看详情）

接口配置编辑页
├── 基本信息
│   ├── 保司（下拉选择）
│   ├── 渠道代码
│   ├── 接口基础地址
│   ├── 接口版本
│   ├── 应用ID
│   ├── 应用密钥
│   └── 环境（测试/生产）
│
├── 接口配置（JSON编辑器）
│   └── 配置各个接口的地址、方法等
│
├── 字段映射配置（JSON编辑器或可视化配置）
│   └── 系统字段 → 保司字段的映射
│
├── 拦截规则配置（JSON编辑器或可视化配置）
│   └── 承保前的校验规则
│
└── 数据校验规则配置（JSON编辑器或可视化配置）
    └── 字段级别的校验规则
```

---

### 2.8 配置文件导入模块

**功能**：
- 上传配置文件（YAML或JSON格式）
- 选择导入类型（产品配置/接口配置/责任配置等）
- 预览导入数据
- 执行导入
- 查看导入历史

**界面设计**：
```
配置文件导入页
├── 导入类型选择
│   ├── 产品配置
│   ├── 接口配置
│   ├── 责任配置
│   └── 费率配置
│
├── 文件上传
│   ├── 选择文件按钮
│   └── 支持格式：YAML、JSON
│
├── 导入预览
│   └── 显示解析后的数据预览
│
├── 导入执行
│   └── 执行导入按钮
│
└── 导入历史
    └── 显示历史导入记录
        ├── 导入时间
        ├── 导入类型
        ├── 文件名
        ├── 导入状态
        └── 成功/失败数量
```

---

## 三、核心功能详细设计

### 3.1 方案责任配置功能（最重要）

**业务场景**：
- 用户需要为"方案一"配置包含哪些责任，以及每个责任的保额选项

**操作流程**：

1. **进入方案责任配置页**
   - 从方案列表页点击"配置责任"
   - 或从方案详情页进入

2. **查看当前配置**
   - 显示方案已配置的责任列表
   - 显示每个责任的保额选项

3. **添加责任**
   - 点击"添加责任"按钮
   - 弹出责任选择器
   - 从该保司的责任列表中选择（只显示该保司的责任）
   - 选择后，弹出责任配置表单

4. **配置责任**
   - **是否必选**：开关，默认必选
   - **保额选项**：
     - 方式1：JSON编辑器直接编辑（如：`["10万","30万","50万"]`）
     - 方式2：可视化配置（推荐）
       - 点击"添加选项"按钮
       - 输入保额值（如：10万）
       - 可以添加多个选项
       - 自动生成JSON格式
   - **默认保额**：下拉选择，从保额选项中选择
   - **最小/最大保额**：可选，用于校验
   - **单位**：下拉选择（元/天/比例等）
   - **显示顺序**：数字输入，用于前端展示顺序

5. **编辑责任配置**
   - 点击"编辑"按钮
   - 弹出编辑表单
   - 修改配置后保存

6. **删除责任配置**
   - 点击"删除"按钮
   - 确认后删除

7. **保存配置**
   - 点击"保存"按钮
   - 系统验证配置完整性
   - 保存到数据库

**可视化配置示例**：

```
责任配置：意外身故伤残保险金
├── 是否必选：✓（开关）
├── 保额选项：
│   ├── [10万] [删除]
│   ├── [30万] [删除]
│   ├── [50万] [删除]
│   ├── [80万] [删除]
│   ├── [100万] [删除]
│   └── [+ 添加选项]
├── 默认保额：10万（下拉选择）
├── 最小保额：（可选）
├── 最大保额：（可选）
├── 单位：元（下拉选择）
└── 显示顺序：1（数字输入）
```

---

### 3.2 批量导入功能

**支持导入的配置类型**：

1. **保司责任配置**
```yaml
company_code: LIBO
liabilities:
  - liability_code: DEATH_BENEFIT
    liability_name: 意外身故伤残保险金
    liability_type: 身故
    unit_type: 金额
  - liability_code: MEDICAL_BENEFIT
    liability_name: 医疗费用保险金
    liability_type: 医疗
    unit_type: 金额
```

2. **产品配置**
```yaml
company_code: LIBO
products:
  - product_code: PRODUCT_A
    product_name: 雇主责任险A
    product_type: 雇主责任险
    registration_no: C0000173309120250101001
```

3. **方案配置**
```yaml
company_code: LIBO
product_code: PRODUCT_A
plans:
  - plan_code: PLAN_01
    plan_name: 方案一
    job_class_range: 1~3类
    duration_options: ["1年","6个月"]
```

4. **方案责任配置**
```yaml
company_code: LIBO
product_code: PRODUCT_A
plan_code: PLAN_01
liabilities:
  - liability_code: DEATH_BENEFIT
    is_required: true
    coverage_options: ["10万","30万","50万","80万","100万"]
    default_coverage: 10万
    unit: 元
    display_order: 1
  - liability_code: MEDICAL_BENEFIT
    is_required: true
    coverage_options: ["1万","2万","5万"]
    default_coverage: 1万
    unit: 元
    display_order: 2
```

5. **费率配置**
```yaml
company_code: LIBO
product_code: PRODUCT_A
rates:
  - liability_code: DEATH_BENEFIT
    job_class: 1类
    coverage_amount: 10万
    base_rate: 0.0081
    rate_factor: 1.0
    effective_date: 2025-01-01
```

6. **接口配置**
```yaml
company_code: LIBO
channel_code: LEXUAN
api_base_url: https://api.libo.com
api_version: v1
app_id: xxx
app_secret: xxx
api_config:
  underwriting:
    url: /api/underwriting
    method: POST
field_mapping:
  underwriting:
    application_no: proposalNo
    company_name: applicantName
```

---

## 四、系统架构设计

### 4.1 技术选型建议

**后端**：
- 框架：Node.js + Express 或 Python + FastAPI
- 数据库：MySQL（已设计）
- ORM：Sequelize（Node.js）或 SQLAlchemy（Python）

**前端**：
- 框架：React + Ant Design 或 Vue + Element UI
- 状态管理：Redux 或 Vuex
- 表单：React Hook Form 或 VeeValidate

### 4.2 核心API设计

#### 4.2.1 保司管理API

```
GET    /api/insurance-companies          # 获取保司列表
POST   /api/insurance-companies          # 创建保司
GET    /api/insurance-companies/:id      # 获取保司详情
PUT    /api/insurance-companies/:id      # 更新保司
DELETE /api/insurance-companies/:id      # 删除保司
```

#### 4.2.2 责任管理API

```
GET    /api/companies/:companyId/liabilities     # 获取保司的责任列表
POST   /api/companies/:companyId/liabilities     # 创建责任
PUT    /api/liabilities/:id                     # 更新责任
DELETE /api/liabilities/:id                      # 删除责任
POST   /api/liabilities/batch-import              # 批量导入责任
```

#### 4.2.3 产品管理API

```
GET    /api/companies/:companyId/products        # 获取保司的产品列表
POST   /api/companies/:companyId/products        # 创建产品
GET    /api/products/:id                         # 获取产品详情
PUT    /api/products/:id                         # 更新产品
DELETE /api/products/:id                         # 删除产品
POST   /api/products/batch-import                # 批量导入产品
```

#### 4.2.4 方案管理API

```
GET    /api/products/:productId/plans            # 获取产品的方案列表
POST   /api/products/:productId/plans             # 创建方案
GET    /api/plans/:id                             # 获取方案详情
PUT    /api/plans/:id                             # 更新方案
DELETE /api/plans/:id                             # 删除方案
POST   /api/plans/batch-import                    # 批量导入方案
```

#### 4.2.5 方案责任配置API

```
GET    /api/plans/:planId/liabilities            # 获取方案的责任配置列表
POST   /api/plans/:planId/liabilities            # 添加责任配置
PUT    /api/plan-liabilities/:id                  # 更新责任配置
DELETE /api/plan-liabilities/:id                  # 删除责任配置
POST   /api/plan-liabilities/batch-update         # 批量更新责任配置
```

#### 4.2.6 费率配置API

```
GET    /api/rates                                 # 获取费率列表（支持多条件筛选）
POST   /api/rates                                 # 创建费率
PUT    /api/rates/:id                             # 更新费率
DELETE /api/rates/:id                             # 删除费率
POST   /api/rates/batch-import                    # 批量导入费率
```

#### 4.2.7 接口配置API

```
GET    /api/api-configs                           # 获取接口配置列表
POST   /api/api-configs                           # 创建接口配置
GET    /api/api-configs/:id                       # 获取接口配置详情
PUT    /api/api-configs/:id                       # 更新接口配置
DELETE /api/api-configs/:id                       # 删除接口配置
POST   /api/api-configs/import                    # 导入接口配置
```

#### 4.2.8 配置文件导入API

```
POST   /api/config-imports/upload                 # 上传配置文件
POST   /api/config-imports/preview                 # 预览导入数据
POST   /api/config-imports/execute                # 执行导入
GET    /api/config-imports                        # 获取导入历史
GET    /api/config-imports/:id                    # 获取导入详情
```

---

## 五、界面设计建议

### 5.1 整体布局

```
┌─────────────────────────────────────────┐
│  顶部导航栏（Logo、用户信息、退出）        │
├──────────┬──────────────────────────────┤
│          │                              │
│  侧边栏  │        主内容区              │
│  菜单    │                              │
│          │                              │
│  - 保司管理                             │
│  - 责任管理                             │
│  - 产品管理                             │
│  - 方案管理                             │
│  - 费率配置                             │
│  - 接口配置                             │
│  - 配置导入                             │
│          │                              │
└──────────┴──────────────────────────────┘
```

### 5.2 方案责任配置页面详细设计

```
┌─────────────────────────────────────────────────────────┐
│  方案责任配置 - 方案一                                    │
├─────────────────────────────────────────────────────────┤
│  方案信息：                                              │
│  保司：利宝保险 | 产品：雇主责任险A | 方案：方案一        │
├─────────────────────────────────────────────────────────┤
│  责任配置列表                                            │
│  ┌──────────────────────────────────────────────────┐  │
│  │ [添加责任]                                        │  │
│  ├──────┬──────┬──────────┬──────────┬──────┬─────┤  │
│  │ 责任 │ 必选 │ 保额选项 │ 默认保额 │ 单位 │ 操作│  │
│  ├──────┼──────┼──────────┼──────────┼──────┼─────┤  │
│  │ 意外 │  ✓  │ 10万/30万│   10万   │  元  │编辑 │  │
│  │ 身故 │     │ /50万... │          │      │删除 │  │
│  ├──────┼──────┼──────────┼──────────┼──────┼─────┤  │
│  │ 医疗 │  ✓  │ 1万/2万  │   1万    │  元  │编辑 │  │
│  │ 费用 │     │ /5万     │          │      │删除 │  │
│  └──────┴──────┴──────────┴──────────┴──────┴─────┘  │
│                                                          │
│  [保存配置] [取消]                                       │
└─────────────────────────────────────────────────────────┘

添加/编辑责任配置弹窗：
┌─────────────────────────────────────┐
│  配置责任                            │
├─────────────────────────────────────┤
│  责任： [下拉选择：意外身故伤残...]  │
│  是否必选： [✓]                      │
│  保额选项：                          │
│    ┌────────┐ ┌────────┐            │
│    │ 10万   │ │ 30万   │ [+ 添加]   │
│    └────────┘ └────────┘            │
│  默认保额： [下拉：10万]             │
│  单位： [下拉：元]                   │
│  显示顺序： [输入：1]                │
│                                      │
│  [确定] [取消]                       │
└─────────────────────────────────────┘
```

---

## 六、配置文件格式设计

### 6.1 完整配置文件示例（YAML格式）

```yaml
# 保司配置
company:
  code: LIBO
  name: 利宝保险
  contact_name: 张三
  contact_phone: 13800138000
  contact_email: contact@libo.com

# 责任配置
liabilities:
  - code: DEATH_BENEFIT
    name: 意外身故伤残保险金
    type: 身故
    unit_type: 金额
    description: 意外身故或伤残的保险金
  - code: MEDICAL_BENEFIT
    name: 医疗费用保险金
    type: 医疗
    unit_type: 金额
  - code: DAILY_HOSPITAL
    name: 意外每日住院津贴
    type: 津贴
    unit_type: 天数

# 产品配置
products:
  - code: PRODUCT_A
    name: 雇主责任险A
    type: 雇主责任险
    registration_no: C0000173309120250101001
    registration_name: 雇主责任险（2025版）
    
    # 方案配置
    plans:
      - code: PLAN_01
        name: 方案一
        job_class_range: 1~3类
        duration_options: ["1年","6个月"]
        payment_type: 一次交清
        
        # 方案责任配置
        liabilities:
          - liability_code: DEATH_BENEFIT
            is_required: true
            coverage_options: ["10万","30万","50万","80万","100万"]
            default_coverage: 10万
            unit: 元
            display_order: 1
          - liability_code: MEDICAL_BENEFIT
            is_required: true
            coverage_options: ["1万","2万","5万"]
            default_coverage: 1万
            unit: 元
            display_order: 2
          - liability_code: DAILY_HOSPITAL
            is_required: true
            coverage_options: ["100元/天"]
            default_coverage: 100元/天
            unit: 元/天
            display_order: 3

# 费率配置
rates:
  - product_code: PRODUCT_A
    liability_code: DEATH_BENEFIT
    job_class: 1类
    coverage_amount: 10万
    base_rate: 0.0081
    rate_factor: 1.0
    effective_date: 2025-01-01
  - product_code: PRODUCT_A
    liability_code: DEATH_BENEFIT
    job_class: 1类
    coverage_amount: 30万
    base_rate: 0.0146
    rate_factor: 1.0
    effective_date: 2025-01-01

# 接口配置
api_config:
  channel_code: LEXUAN
  api_base_url: https://api.libo.com
  api_version: v1
  app_id: xxx
  app_secret: xxx
  environment: production
  
  api_config:
    underwriting:
      url: /api/underwriting
      method: POST
      timeout: 30000
    issuance:
      url: /api/issuance
      method: POST
  
  field_mapping:
    underwriting:
      application_no: proposalNo
      company_name: applicantName
      credit_code: applicantIdNo
  
  intercept_rules:
    underwriting:
      - rule_name: 被保人数限制
        check_field: insured_count
        check_operator: between
        check_value: [1, 100]
        error_code: E001
        error_message: 被保人数必须在1-100人之间
```

---

## 七、实施建议

### 7.1 开发优先级

**第一阶段**：核心配置功能
1. 保司管理
2. 责任管理
3. 产品管理
4. 方案管理
5. 方案责任配置（核心功能）

**第二阶段**：扩展功能
1. 费率配置
2. 接口配置
3. 配置文件导入

**第三阶段**：优化功能
1. 配置验证
2. 配置预览
3. 配置历史

### 7.2 技术实现建议

1. **使用现成的UI组件库**：
   - Ant Design（React）或 Element UI（Vue）
   - 提供表格、表单、弹窗等组件

2. **JSON编辑器**：
   - 使用 Monaco Editor 或 CodeMirror
   - 支持JSON语法高亮和校验

3. **表单验证**：
   - 前端验证：确保数据格式正确
   - 后端验证：确保数据完整性

4. **配置导入**：
   - 支持YAML和JSON格式
   - 使用 js-yaml 或 yamljs 解析YAML
   - 解析后验证数据结构
   - 批量插入数据库

---

## 八、总结

这个后台配置系统的核心是：
1. **层级化管理**：保司 → 产品 → 方案 → 责任，清晰的层级关系
2. **可视化配置**：通过界面配置，无需写代码
3. **批量导入**：支持通过配置文件批量导入
4. **配置验证**：配置时自动验证数据完整性

最关键的功能是**方案责任配置**，需要提供友好的界面让用户配置每个方案包含哪些责任，以及每个责任的保额选项。

