# ç¼–ç é—®é¢˜ä¿®å¤æ€»ç»“

## ä¸€ã€é—®é¢˜æ ¹æº

### æ ¸å¿ƒé—®é¢˜ï¼šMySQLè¿æ¥å­—ç¬¦é›†é…ç½®ä¸ä¸€è‡´

**å‘ç°çš„é—®é¢˜**ï¼š
```
character_set_client:     latin1  âŒ
character_set_connection: latin1  âŒ  
character_set_results:    latin1  âŒ
character_set_database:   utf8mb4 âœ…
character_set_server:     utf8mb4 âœ…
```

**å½±å“**ï¼š
- æ’å…¥æ•°æ®æ—¶ï¼ŒUTF-8å­—ç¬¦ä¸²è¢«å½“ä½œlatin1å¤„ç†
- å­˜å‚¨çš„æ•°æ®ç¼–ç é”™è¯¯ï¼ˆHEX: `C3A5C290...` è€Œä¸æ˜¯ `E590AFE794A8`ï¼‰
- å³ä½¿è¡¨æ˜¯utf8mb4ï¼Œæ•°æ®æœ¬èº«å·²ç»æŸå

---

## äºŒã€å·²å®æ–½çš„ä¿®å¤

### 1. å¢å¼ºè¿æ¥æ± å­—ç¬¦é›†è®¾ç½® âœ…

**æ–‡ä»¶**ï¼š`backend/config/database.js`

**ä¿®æ”¹**ï¼š
- åœ¨è¿æ¥æ± é…ç½®ä¸­æ˜ç¡®è®¾ç½® `charset: 'utf8mb4'`
- åœ¨æ¯æ¬¡è¿æ¥å»ºç«‹æ—¶ï¼Œè®¾ç½®æ‰€æœ‰ç›¸å…³å­—ç¬¦é›†å˜é‡ï¼š
  ```javascript
  await connection.query('SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci');
  await connection.query('SET CHARACTER SET utf8mb4');
  await connection.query('SET character_set_connection = utf8mb4');
  await connection.query('SET character_set_client = utf8mb4');
  await connection.query('SET character_set_results = utf8mb4');
  ```

**ä½œç”¨**ï¼šç¡®ä¿æ¯æ¬¡ä»è¿æ¥æ± è·å–çš„è¿æ¥éƒ½ä½¿ç”¨æ­£ç¡®çš„å­—ç¬¦é›†ã€‚

### 2. ä¿®å¤å·²å­˜å‚¨çš„é”™è¯¯æ•°æ® âœ…

**SQLä¿®å¤è¯­å¥**ï¼š
```sql
UPDATE insurance_products 
SET status = CONVERT(CONVERT(status USING latin1) USING utf8mb4)
WHERE product_id = 2;
```

**åŸç†**ï¼š
1. å…ˆå‘Šè¯‰MySQLï¼šè¿™ä¸ªå­—æ®µå½“å‰æ˜¯latin1ç¼–ç 
2. ç„¶åè½¬æ¢æˆutf8mb4ç¼–ç 
3. è¿™æ ·å°±èƒ½æ¢å¤æ­£ç¡®çš„å­—ç¬¦

---

## ä¸‰ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

1. **MySQLé»˜è®¤é…ç½®**ï¼šæŸäº›MySQLç‰ˆæœ¬é»˜è®¤ä½¿ç”¨ `latin1` ä½œä¸ºè¿æ¥å­—ç¬¦é›†
2. **è¿æ¥æ± å¤ç”¨**ï¼šè¿æ¥æ± å¯èƒ½å¤ç”¨äº†æœªæ­£ç¡®è®¾ç½®å­—ç¬¦é›†çš„è¿æ¥
3. **äº‹ä»¶è§¦å‘æ—¶æœº**ï¼š`pool.on('connection')` å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹ä¸è§¦å‘
4. **æ•°æ®æ’å…¥æ—¶æœº**ï¼šå¯èƒ½åœ¨å­—ç¬¦é›†è®¾ç½®ä¹‹å‰å°±æ’å…¥äº†æ•°æ®

---

## å››ã€é¢„é˜²æªæ–½

### 1. æ•°æ®åº“çº§åˆ« âœ…
```sql
CREATE DATABASE ... DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. è¡¨çº§åˆ« âœ…
```sql
CREATE TABLE ... DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 3. è¿æ¥æ± çº§åˆ« âœ…
```javascript
charset: 'utf8mb4'
```

### 4. è¿æ¥çº§åˆ« âœ…
æ¯æ¬¡è¿æ¥å»ºç«‹æ—¶è®¾ç½®å­—ç¬¦é›†å˜é‡

### 5. HTTPå“åº”çº§åˆ« âœ…
```javascript
res.setHeader('Content-Type', 'application/json; charset=utf-8');
```

---

## äº”ã€éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥æ•°æ®
```sql
SELECT product_id, status, HEX(status) 
FROM insurance_products 
WHERE product_id = 2;
```

æ­£ç¡®çš„HEXå€¼åº”è¯¥æ˜¯ï¼š`E590AFE794A8`ï¼ˆ"å¯ç”¨"çš„UTF-8ç¼–ç ï¼‰

### 2. æµ‹è¯•API
```bash
curl http://localhost:8888/api/products
```

åº”è¯¥è¿”å›æ­£ç¡®çš„UTF-8å­—ç¬¦ï¼Œæ²¡æœ‰ä¹±ç ã€‚

---

## å…­ã€æœ€ä½³å®è·µæ€»ç»“

âœ… **æ•°æ®åº“**ï¼šåˆ›å»ºæ—¶æ˜ç¡®è®¾ç½® `utf8mb4`  
âœ… **è¡¨**ï¼šåˆ›å»ºæ—¶æ˜ç¡®è®¾ç½® `DEFAULT CHARSET=utf8mb4`  
âœ… **è¿æ¥æ± **ï¼šé…ç½®ä¸­è®¾ç½® `charset: 'utf8mb4'`  
âœ… **è¿æ¥**ï¼šæ¯æ¬¡è¿æ¥å»ºç«‹æ—¶è®¾ç½®å­—ç¬¦é›†å˜é‡  
âœ… **HTTP**ï¼šå“åº”å¤´è®¾ç½® `charset=utf-8`  

---

**ç°åœ¨è¯·åˆ·æ–°å‰ç«¯é¡µé¢ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æ­£ç¡®çš„äº§å“æ•°æ®äº†ï¼** ğŸ‰

