# 方案实例与责任选择业务说明

## 一、业务场景举例

假设利宝保险有一个产品叫"雇主责任险A"，这个产品下有3个方案：

### 产品配置（通过配置文件导入）

**产品：雇主责任险A**
- **方案一**：
  - 职业类别：1~3类
  - 保障时间：1年
  - 包含责任：
    - 意外身故伤残：可选 10万、30万、50万、80万、100万
    - 医疗费用：可选 1万、2万、5万
    - 住院津贴：固定 100元/天
  
- **方案二**：
  - 职业类别：4~5类
  - 保障时间：1年
  - 包含责任：
    - 意外身故伤残：可选 20万、40万、60万
    - 医疗费用：可选 2万、5万、10万
    - 住院津贴：固定 150元/天

- **方案三**：
  - 职业类别：1~5类
  - 保障时间：6个月
  - 包含责任：
    - 意外身故伤残：可选 10万、30万
    - 医疗费用：可选 1万、2万

---

## 二、用户投保操作流程

### 步骤1：选择产品
经纪公司为企业客户录单时，选择"雇主责任险A"这个产品。

### 步骤2：选择方案
系统展示该产品下的3个方案，用户选择"方案一"。

**此时创建 `application_plans` 记录（方案实例）**：
```
方案实例ID: 1001
投保单ID: APP001
方案ID: 方案一的ID（关联product_plans表）
方案名称: "方案一"
职业类别: "1~3类"（用户从方案一的职业类别范围中选择）
保障时间: "1年"（用户从方案一的保障时间选项中选择）
被保人数: 10人（用户填写）
方案保费: 待计算
```

**为什么需要方案实例？**
- 方案模板（product_plans）只定义了"可选范围"（如职业类别范围是1~3类）
- 用户需要选择"具体值"（如选择了"1~3类"中的具体类别，保障时间选择了"1年"）
- 一个投保单可能有多个方案实例（如同时选择方案一和方案二）

### 步骤3：选择责任和保额
用户选择了"方案一"后，系统展示方案一包含的责任和保额选项：

- **意外身故伤残**：下拉框显示 [10万、30万、50万、80万、100万]
- **医疗费用**：下拉框显示 [1万、2万、5万]
- **住院津贴**：显示 100元/天（固定值，不可选）

用户操作：
- 选择"意外身故伤残" = **30万**
- 选择"医疗费用" = **2万**
- "住院津贴" = **100元/天**（自动选中，因为是固定值）

**此时创建 `plan_instance_liabilities` 记录（责任选择）**：
```
记录1:
方案实例ID: 1001
责任ID: 意外身故伤残的责任ID
保额: "30万"
保额数值: 300000
单位: "元"
是否选择: true

记录2:
方案实例ID: 1001
责任ID: 医疗费用的责任ID
保额: "2万"
保额数值: 20000
单位: "元"
是否选择: true

记录3:
方案实例ID: 1001
责任ID: 住院津贴的责任ID
保额: "100元/天"
保额数值: 100
单位: "元/天"
是否选择: true
```

**为什么需要责任选择？**
- 方案模板（plan_liabilities）只定义了"可选选项"（如意外身故可选10万、30万、50万等）
- 用户需要选择"具体值"（如选择了30万）
- 一个方案实例包含多个责任选择（如选择了3个责任）

---

## 三、两层关系的作用

### 3.1 方案实例（application_plans）的作用

**存储内容**：
- 用户选择了哪个方案模板
- 用户在该方案下选择的具体参数（职业类别、保障时间等）
- 该方案对应的被保人数
- 该方案的总保费

**业务意义**：
- **方案是投保的基本单位**：一个投保单可能有多个方案（如方案一给A部门，方案二给B部门）
- **记录用户的选择**：方案模板定义了可选范围，方案实例记录用户选择的具体值
- **便于保费计算**：根据方案实例的参数和责任选择计算保费

**举例**：
- 投保单APP001包含2个方案实例：
  - 方案实例1：方案一，职业类别"1~3类"，保障时间"1年"，10人
  - 方案实例2：方案二，职业类别"4~5类"，保障时间"1年"，5人

### 3.2 责任选择（plan_instance_liabilities）的作用

**存储内容**：
- 用户在方案实例中选择的具体责任
- 每个责任选择的具体保额值

**业务意义**：
- **责任是保费计算的基础**：保费根据责任和保额计算
- **记录用户的选择**：方案模板定义了可选保额，责任选择记录用户选择的具体值
- **用于保单生成**：保单需要记录具体的责任和保额

**举例**：
- 方案实例1（方案一）包含3个责任选择：
  - 意外身故伤残：30万
  - 医疗费用：2万
  - 住院津贴：100元/天

---

## 四、为什么需要两层？

### 4.1 如果只有一层会怎样？

**假设只有方案实例，不记录责任选择**：
- 问题1：无法知道用户选择了哪些责任和保额
- 问题2：保费无法计算（保费需要根据责任和保额计算）
- 问题3：保单无法生成（保单需要记录具体的责任和保额）

### 4.2 两层设计的优势

**方案实例层**：
- 记录方案级别的信息（职业类别、保障时间、被保人数等）
- 一个投保单可以有多个方案实例
- 便于方案级别的统计和管理

**责任选择层**：
- 记录责任级别的信息（具体选择了哪些责任和保额）
- 一个方案实例包含多个责任选择
- 便于保费计算和保单生成

---

## 五、实际业务操作示例

### 场景：企业客户投保

**企业信息**：
- 企业名称：ABC公司
- 需要为两个部门投保：
  - 行政部门（10人，职业类别1~3类）
  - 生产部门（20人，职业类别4~5类）

**操作流程**：

1. **创建投保单**
   - 投保单号：APP001
   - 企业客户：ABC公司

2. **添加方案实例1（行政部门）**
   - 选择产品：雇主责任险A
   - 选择方案：方案一
   - 选择职业类别：1~3类（从方案一的职业类别范围中选择）
   - 选择保障时间：1年（从方案一的保障时间选项中选择）
   - 被保人数：10人
   
   **选择责任和保额**：
   - 意外身故伤残：选择 30万（从方案一的选项中选择）
   - 医疗费用：选择 2万（从方案一的选项中选择）
   - 住院津贴：100元/天（固定值，自动选中）

3. **添加方案实例2（生产部门）**
   - 选择产品：雇主责任险A
   - 选择方案：方案二
   - 选择职业类别：4~5类
   - 选择保障时间：1年
   - 被保人数：20人
   
   **选择责任和保额**：
   - 意外身故伤残：选择 40万
   - 医疗费用：选择 5万
   - 住院津贴：150元/天（固定值）

4. **添加被保人**
   - 为方案实例1添加10个被保人（行政部门的员工）
   - 为方案实例2添加20个被保人（生产部门的员工）

5. **计算保费**
   - 根据方案实例1的责任选择和被保人职业类别计算保费
   - 根据方案实例2的责任选择和被保人职业类别计算保费
   - 汇总得到总保费

---

## 六、数据表关系总结

```
产品 (product_plans)
  ↓ 一对多（一个产品有多个方案）
方案模板 (product_plans)
  ↓ 一对多（一个方案有多个责任配置）
方案责任配置 (plan_liabilities) - 定义可选的责任和保额选项

用户投保时：
  ↓
方案实例 (application_plans) - 用户选择了哪个方案，以及方案级别的参数
  ↓ 一对多（一个方案实例有多个责任选择）
责任选择 (plan_instance_liabilities) - 用户选择了哪些责任和具体的保额值
```

---

## 七、简单理解

**方案实例 = 用户选择了哪个方案 + 方案级别的参数（职业类别、保障时间、被保人数等）**

**责任选择 = 用户在该方案下选择了哪些责任 + 每个责任的具体保额值**

**类比**：
- 方案实例 = 点了一份"套餐"（如：套餐A，中杯，加冰）
- 责任选择 = 套餐里具体选择了哪些"菜品"（如：选择了汉堡、薯条、可乐）

---

## 八、是否需要两层？

**如果业务简单，可以合并**：
- 如果方案下的责任是固定的，不需要用户选择
- 如果每个方案只有一个责任组合
- 那么可以合并到方案实例中

**如果业务复杂，需要两层**：
- 如果方案下的责任需要用户选择（如：可选10万或30万）
- 如果不同用户选择不同的责任组合
- 那么需要两层来记录用户的具体选择

**根据你的业务**：
- 方案下有多个责任，每个责任有多个保额选项
- 用户需要从选项中选择具体的保额值
- 所以需要两层来记录用户的选择

