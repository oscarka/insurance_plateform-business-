# ç³»ç»Ÿæ€§é—®é¢˜å®šä½ä¸ä¿®å¤

## ä¸€ã€é—®é¢˜å®šä½æµç¨‹

### 1. Docker MySQLå®¹å™¨ âœ…
**æ£€æŸ¥é¡¹**ï¼š
- å®¹å™¨æ˜¯å¦ä½¿ç”¨utf8mb4å­—ç¬¦é›†å¯åŠ¨
- MySQLæœåŠ¡å™¨é»˜è®¤å­—ç¬¦é›†é…ç½®

**ç»“æœ**ï¼š
- âœ… å®¹å™¨é…ç½®æ­£ç¡®ï¼š`--character-set-server=utf8mb4`
- âœ… æ•°æ®åº“å­—ç¬¦é›†ï¼š`utf8mb4`
- âœ… è¡¨å­—ç¬¦é›†ï¼š`utf8mb4_unicode_ci`
- âœ… å­—æ®µå­—ç¬¦é›†ï¼š`utf8mb4_unicode_ci`

### 2. MySQLè¿æ¥å­—ç¬¦é›† âš ï¸
**æ£€æŸ¥é¡¹**ï¼š
- è¿æ¥æ—¶çš„å­—ç¬¦é›†å˜é‡
- è¿æ¥æ± æ˜¯å¦æ­£ç¡®è®¾ç½®å­—ç¬¦é›†

**å‘ç°çš„é—®é¢˜**ï¼š
```
character_set_client:     latin1  âŒ
character_set_connection: latin1  âŒ
character_set_results:    latin1  âŒ
```

**åŸå› **ï¼š
- è™½ç„¶è¿æ¥æ± é…ç½®äº†`charset: 'utf8mb4'`
- ä½†`pool.on('connection')`äº‹ä»¶å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹ä¸è§¦å‘
- æˆ–è€…è¿æ¥è¢«å¤ç”¨ï¼Œå­—ç¬¦é›†è®¾ç½®ä¸¢å¤±

### 3. æ•°æ®å­˜å‚¨ âœ…
**æ£€æŸ¥é¡¹**ï¼š
- æ•°æ®åœ¨æ•°æ®åº“ä¸­çš„å®é™…å­˜å‚¨ï¼ˆHEXå€¼ï¼‰
- æ˜¯å¦æ­£ç¡®å­˜å‚¨ä¸ºUTF-8

**ç»“æœ**ï¼š
- âœ… `product_name` HEX: `E99B87E4B8BBE8B4A3E4BBBBE999A941`ï¼ˆæ­£ç¡®ï¼‰
- âœ… `status` HEX: `E590AFE794A8`ï¼ˆæ­£ç¡®ï¼‰

**ç»“è®º**ï¼šæ•°æ®æœ¬èº«å­˜å‚¨æ­£ç¡®ï¼Œé—®é¢˜åœ¨äºè¿æ¥å­—ç¬¦é›†ã€‚

### 4. åç«¯APIå“åº” âœ…
**æ£€æŸ¥é¡¹**ï¼š
- APIè¿”å›çš„JSONæ•°æ®
- å­—ç¬¦ç¼–ç æ˜¯å¦æ­£ç¡®

**ç»“æœ**ï¼š
- âœ… APIè¿”å›æ­£ç¡®çš„UTF-8å­—ç¬¦
- âœ… `status: 'å¯ç”¨'`
- âœ… `product_name: 'é›‡ä¸»è´£ä»»é™©A'`

**ç»“è®º**ï¼šåç«¯è¿æ¥æ± çš„å­—ç¬¦é›†è®¾ç½®ç”Ÿæ•ˆï¼ŒAPIè¿”å›æ­£ç¡®ã€‚

---

## äºŒã€å·²å®æ–½çš„ä¿®å¤

### 1. å¢å¼ºè¿æ¥æ± å­—ç¬¦é›†è®¾ç½® âœ…

**æ–‡ä»¶**ï¼š`backend/config/database.js`

**æ”¹è¿›**ï¼š
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•
- è®°å½•è®¾ç½®å‰åçš„å­—ç¬¦é›†çŠ¶æ€
- ç¡®ä¿æ¯æ¬¡è¿æ¥éƒ½æ­£ç¡®è®¾ç½®

### 2. å¢å¼ºAPIè·¯ç”±æ—¥å¿— âœ…

**æ–‡ä»¶**ï¼š`backend/routes/products.js`

**æ”¹è¿›**ï¼š
- åœ¨æŸ¥è¯¢å‰æ£€æŸ¥è¿æ¥å­—ç¬¦é›†
- è®°å½•æŸ¥è¯¢ç»“æœçš„HEXå€¼
- éªŒè¯ä¸­æ–‡å­—ç¬¦æ˜¯å¦æ­£ç¡®

### 3. é‡æ–°åˆå§‹åŒ–æµ‹è¯•æ•°æ® âœ…

**æ“ä½œ**ï¼š
- æ¸…ç©ºæ‰€æœ‰æµ‹è¯•æ•°æ®
- ä½¿ç”¨æ­£ç¡®çš„å­—ç¬¦é›†é‡æ–°æ’å…¥
- éªŒè¯æ•°æ®ç¼–ç 

---

## ä¸‰ã€éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥æ•°æ®åº“æ•°æ®
```bash
docker exec -i mysql-insurance mysql -uroot -p123456 insurance_platform \
  -e "SET NAMES utf8mb4; SELECT product_id, product_name, status, HEX(status) FROM insurance_products;"
```

### 2. æ£€æŸ¥åç«¯æ—¥å¿—
```bash
tail -f /tmp/backend.log | grep -E "æ•°æ®åº“è¿æ¥|å­—ç¬¦é›†|product_name"
```

### 3. æµ‹è¯•API
```bash
curl http://localhost:8888/api/products
```

### 4. æ£€æŸ¥å‰ç«¯
- åˆ·æ–°æµè§ˆå™¨é¡µé¢
- æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
- éªŒè¯äº§å“åˆ—è¡¨æ˜¯å¦æ˜¾ç¤º

---

## å››ã€é—®é¢˜æ ¹æºæ€»ç»“

### æ ¸å¿ƒé—®é¢˜
**MySQLè¿æ¥å­—ç¬¦é›†é…ç½®ä¸ä¸€è‡´**

è™½ç„¶ï¼š
- âœ… Docker MySQLå®¹å™¨é…ç½®äº†utf8mb4
- âœ… æ•°æ®åº“ã€è¡¨ã€å­—æ®µéƒ½æ˜¯utf8mb4
- âœ… æ•°æ®å­˜å‚¨æ­£ç¡®ï¼ˆHEXå€¼éªŒè¯ï¼‰

ä½†æ˜¯ï¼š
- âŒ è¿æ¥æ—¶çš„å­—ç¬¦é›†å˜é‡æ˜¯latin1
- âŒ å¯¼è‡´æŸ¥è¯¢æ—¶æ•°æ®è¢«é”™è¯¯è§£é‡Š

### è§£å†³æ–¹æ¡ˆ
1. âœ… åœ¨è¿æ¥æ± é…ç½®ä¸­æ˜ç¡®è®¾ç½®`charset: 'utf8mb4'`
2. âœ… åœ¨æ¯æ¬¡è¿æ¥å»ºç«‹æ—¶è®¾ç½®å­—ç¬¦é›†å˜é‡
3. âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—è¿½è¸ªå­—ç¬¦é›†è®¾ç½®è¿‡ç¨‹
4. âœ… åœ¨APIè·¯ç”±ä¸­éªŒè¯å­—ç¬¦é›†çŠ¶æ€

---

## äº”ã€æœ€ä½³å®è·µ

### 1. Docker MySQLå¯åŠ¨
```bash
docker run -d \
  --name mysql-insurance \
  -e MYSQL_CHARSET=utf8mb4 \
  -e MYSQL_COLLATION=utf8mb4_unicode_ci \
  mysql:8.0 \
  --character-set-server=utf8mb4 \
  --collation-server=utf8mb4_unicode_ci
```

### 2. è¿æ¥æ± é…ç½®
```javascript
const pool = mysql.createPool({
  charset: 'utf8mb4',
  // ...
});

pool.on('connection', async (connection) => {
  await connection.query('SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci');
  // ... å…¶ä»–è®¾ç½®
});
```

### 3. SQLè„šæœ¬
```sql
SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci;
-- ... æ’å…¥æ•°æ®
```

### 4. æ‰§è¡ŒSQLæ—¶
```bash
mysql --default-character-set=utf8mb4 < script.sql
```

---

**ç°åœ¨è¯·æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œç¡®è®¤å­—ç¬¦é›†è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼** ğŸ”

