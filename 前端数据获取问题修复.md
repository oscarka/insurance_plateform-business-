# å‰ç«¯æ•°æ®è·å–é—®é¢˜ä¿®å¤

## ä¸€ã€é—®é¢˜åˆ†æ

### ä»æ—¥å¿—çœ‹åˆ°çš„é—®é¢˜

1. **APIè°ƒç”¨æˆåŠŸ** âœ…
   - çŠ¶æ€ï¼š200 OK
   - Content-Typeï¼šapplication/json; charset=utf-8

2. **å“åº”æ•°æ®** âš ï¸
   - å“åº”æ–‡æœ¬ï¼š`{"success":true,"data":[],"count":0}`
   - **dataæ˜¯ç©ºæ•°ç»„ï¼**

3. **å‰ç«¯å¤„ç†** âš ï¸
   - è·å–åˆ°çš„æ•°æ®ï¼š`[]`ï¼ˆç©ºæ•°ç»„ï¼‰
   - è¿‡æ»¤åçš„äº§å“æ•°é‡ï¼š0

---

## äºŒã€é—®é¢˜æ ¹æº

### 1. æ•°æ®åº“ä¸­çš„äº§å“çŠ¶æ€

**æ£€æŸ¥ç»“æœ**ï¼š
- æ•°æ®åº“ä¸­åªæœ‰1ä¸ªäº§å“ï¼ˆproduct_id=2ï¼‰
- äº§å“çŠ¶æ€æ˜¾ç¤ºä¸ºä¹±ç ï¼ˆå¯èƒ½æ˜¯ç¼–ç é—®é¢˜ï¼‰
- SQLæŸ¥è¯¢æ¡ä»¶ï¼š`WHERE (p.status = 'å¯ç”¨' OR p.status IS NULL OR p.status = '')`

**é—®é¢˜**ï¼šè™½ç„¶åç«¯æ—¥å¿—æ˜¾ç¤ºæŸ¥è¯¢åˆ°äº†æ•°æ®ï¼Œä½†å¯èƒ½ï¼š
1. çŠ¶æ€å­—æ®µçš„ç¼–ç é—®é¢˜å¯¼è‡´æ¡ä»¶ä¸åŒ¹é…
2. æˆ–è€…æœ‰å¤šä¸ªè¯·æ±‚ï¼Œå…¶ä¸­ä¸€ä¸ªè¿”å›äº†ç©ºæ•°æ®

### 2. å‰ç«¯å“åº”å¤„ç†

**é—®é¢˜**ï¼š`getProducts()` å‡½æ•°å¯èƒ½æ²¡æœ‰æ­£ç¡®æå– `data` å­—æ®µ

---

## ä¸‰ã€å·²ä¿®å¤çš„é—®é¢˜

### 1. æ›´æ–°äº§å“çŠ¶æ€ âœ…

```sql
UPDATE insurance_products SET status = 'å¯ç”¨' WHERE product_id IN (1, 2);
```

### 2. ä¿®å¤å‰ç«¯å“åº”å¤„ç† âœ…

```typescript
// src/services/api.ts
export const getProducts = async (params?: { company_code?: string }) => {
  const response = await request(`/products${queryString}`);
  
  // å¦‚æœè¿”å›çš„æ˜¯å®Œæ•´å¯¹è±¡ï¼Œæå–dataå­—æ®µ
  if (response && typeof response === 'object' && 'data' in response) {
    return response.data || [];
  }
  
  // å¦‚æœå·²ç»æ˜¯æ•°ç»„ï¼Œç›´æ¥è¿”å›
  if (Array.isArray(response)) {
    return response;
  }
  
  return [];
};
```

### 3. åœ¨requestå‡½æ•°ä¸­å¤„ç† âœ…

```typescript
// å¯¹äºproductsæ¥å£ï¼Œè¿”å›dataå­—æ®µ
if (url.includes('/products') && data.success && data.data) {
  return data.data;
}
```

---

## å››ã€æµ‹è¯•æ­¥éª¤

### 1. åˆ·æ–°æµè§ˆå™¨é¡µé¢

æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°ï¼š
- Windows/Linux: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

### 2. æŸ¥çœ‹æ§åˆ¶å°

åº”è¯¥çœ‹åˆ°ï¼š
- `getProducts: æå–dataå­—æ®µï¼Œæ•°é‡: 1`
- æˆ–è€… `getProducts: ç›´æ¥è¿”å›æ•°ç»„ï¼Œæ•°é‡: 1`

### 3. æ£€æŸ¥äº§å“åˆ—è¡¨

ä¸‹æ‹‰æ¡†åº”è¯¥æ˜¾ç¤ºï¼š
- `é›‡ä¸»è´£ä»»é™©A (åˆ©å®ä¿é™©)`

---

## äº”ã€å¦‚æœè¿˜æ˜¯ç©ºæ•°ç»„

### æ£€æŸ¥1ï¼šæ•°æ®åº“ä¸­çš„äº§å“çŠ¶æ€

```sql
SELECT product_id, product_name, status, HEX(status) as status_hex
FROM insurance_products;
```

### æ£€æŸ¥2ï¼šåç«¯æ—¥å¿—

```bash
tail -f /tmp/backend.log | grep "æŸ¥è¯¢ç»“æœæ•°é‡\|ç¬¬ä¸€æ¡ç»“æœ"
```

åº”è¯¥çœ‹åˆ°ï¼š
- `æŸ¥è¯¢ç»“æœæ•°é‡: 1`
- `product_name: é›‡ä¸»è´£ä»»é™©A`

### æ£€æŸ¥3ï¼šAPIå“åº”

```bash
curl http://localhost:8888/api/products
```

åº”è¯¥è¿”å›ï¼š
```json
{"success":true,"data":[{"product_id":2,"product_name":"é›‡ä¸»è´£ä»»é™©A",...}],"count":1}
```

---

## å…­ã€ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœäº§å“çŠ¶æ€å­—æ®µæœ‰ç¼–ç é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶ä¿®æ”¹SQLæŸ¥è¯¢ï¼š

```javascript
// æš‚æ—¶ç§»é™¤çŠ¶æ€è¿‡æ»¤ï¼Œè¿”å›æ‰€æœ‰äº§å“
WHERE 1=1
```

æˆ–è€…ï¼š

```javascript
// ä½¿ç”¨HEXå€¼åŒ¹é…
WHERE HEX(p.status) = HEX('å¯ç”¨') OR p.status IS NULL OR p.status = ''
```

---

**è¯·åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œå‘Šè¯‰æˆ‘ç°åœ¨çš„æƒ…å†µï¼** ğŸ”

