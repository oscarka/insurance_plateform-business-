# æ¥å£å‚æ•°é—®é¢˜ä¿®å¤

## ä¸€ã€é—®é¢˜å‘ç°

### é—®é¢˜ç°è±¡
- **æµè§ˆå™¨ç›´æ¥è®¿é—®**ï¼š`http://localhost:8888/api/products` è¿”å› 1 æ¡æ•°æ® âœ…
- **å‰ç«¯è°ƒç”¨**ï¼šè¿”å› `{"success":true,"data":[],"count":0}` âŒ

### é—®é¢˜æ ¹æº
å‰ç«¯è°ƒç”¨æ—¶å¯èƒ½ä¼ é€’äº† `company_code=undefined` ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼Œå¯¼è‡´åç«¯æŸ¥è¯¢æ¡ä»¶ä¸åŒ¹é…ã€‚

---

## äºŒã€é—®é¢˜åˆ†æ

### å‰ç«¯è°ƒç”¨
```typescript
const productList = await getProducts({ company_code: companyCode });
```

å¦‚æœ `companyCode` æ˜¯ `undefined`ï¼Œ`URLSearchParams` ä¼šå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸² `"undefined"`ï¼š
```
?company_code=undefined
```

### åç«¯å¤„ç†
```javascript
if (company_code) {
  sql += ' AND ic.company_code = ?';
  params.push(company_code);
}
```

å¦‚æœ `company_code` æ˜¯å­—ç¬¦ä¸² `"undefined"`ï¼Œæ¡ä»¶ä¼šæ‰§è¡Œï¼Œä½†æ•°æ®åº“ä¸­ä¸å­˜åœ¨ `company_code = 'undefined'` çš„è®°å½•ï¼Œæ‰€ä»¥è¿”å›ç©ºæ•°ç»„ã€‚

---

## ä¸‰ã€å·²å®æ–½çš„ä¿®å¤

### 1. å‰ç«¯å‚æ•°æ¸…ç† âœ…

**æ–‡ä»¶**ï¼š`src/services/api.ts`

**ä¿®æ”¹**ï¼š
```typescript
export const getProducts = async (params?: { company_code?: string }) => {
  // è¿‡æ»¤æ‰undefinedå’Œç©ºå­—ç¬¦ä¸²çš„å‚æ•°
  const cleanParams: any = {};
  if (params && params.company_code && params.company_code !== 'undefined' && params.company_code.trim() !== '') {
    cleanParams.company_code = params.company_code;
  }
  const queryString = Object.keys(cleanParams).length > 0 
    ? `?${new URLSearchParams(cleanParams).toString()}` 
    : '';
  console.log('getProductsè°ƒç”¨å‚æ•°:', params, 'æ¸…ç†å:', cleanParams, 'æŸ¥è¯¢å­—ç¬¦ä¸²:', queryString);
  const response = await request(`/products${queryString}`);
  // ...
};
```

**ä½œç”¨**ï¼š
- è¿‡æ»¤æ‰ `undefined`ã€ç©ºå­—ç¬¦ä¸²ã€å­—ç¬¦ä¸² `"undefined"`
- åªåœ¨æœ‰æœ‰æ•ˆå€¼æ—¶æ‰æ·»åŠ æŸ¥è¯¢å‚æ•°

### 2. åç«¯å‚æ•°æ¸…ç† âœ…

**æ–‡ä»¶**ï¼š`backend/routes/products.js`

**ä¿®æ”¹**ï¼š
```javascript
router.get('/', async (req, res) => {
  try {
    let { company_code } = req.query;
    
    // æ¸…ç†å‚æ•°ï¼šå¦‚æœæ˜¯undefinedå­—ç¬¦ä¸²æˆ–ç©ºå­—ç¬¦ä¸²ï¼Œè®¾ä¸ºundefined
    if (company_code === 'undefined' || company_code === '' || !company_code) {
      company_code = undefined;
    }
    
    console.log('åŸå§‹æŸ¥è¯¢å‚æ•°:', req.query);
    console.log('æ¸…ç†åçš„æŸ¥è¯¢å‚æ•°:', { company_code });
    // ...
  }
});
```

**ä½œç”¨**ï¼š
- å°†å­—ç¬¦ä¸² `"undefined"` å’Œç©ºå­—ç¬¦ä¸²è½¬æ¢ä¸º `undefined`
- ç¡®ä¿æŸ¥è¯¢é€»è¾‘æ­£ç¡®

---

## å››ã€éªŒè¯

### 1. æµ‹è¯•æ— å‚æ•°
```bash
curl http://localhost:8888/api/products
```
åº”è¯¥è¿”å›æ‰€æœ‰äº§å“ã€‚

### 2. æµ‹è¯•undefinedå‚æ•°
```bash
curl "http://localhost:8888/api/products?company_code=undefined"
```
åº”è¯¥è¿”å›æ‰€æœ‰äº§å“ï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰ã€‚

### 3. æµ‹è¯•æœ‰æ•ˆå‚æ•°
```bash
curl "http://localhost:8888/api/products?company_code=LIBO"
```
åº”è¯¥è¿”å›æŒ‡å®šä¿å¸çš„äº§å“ã€‚

---

## äº”ã€å‰ç«¯è°ƒç”¨æµç¨‹

### ä¿®æ”¹å‰
```
fetchProducts() 
  â†’ getProducts({ company_code: undefined })
  â†’ URL: /products?company_code=undefined
  â†’ åç«¯æŸ¥è¯¢: WHERE company_code = 'undefined'
  â†’ è¿”å›: []
```

### ä¿®æ”¹å
```
fetchProducts() 
  â†’ getProducts({ company_code: undefined })
  â†’ æ¸…ç†å‚æ•°: {}
  â†’ URL: /products
  â†’ åç«¯æŸ¥è¯¢: WHERE 1=1
  â†’ è¿”å›: [æ‰€æœ‰äº§å“]
```

---

**ç°åœ¨è¯·åˆ·æ–°å‰ç«¯é¡µé¢ï¼Œåº”è¯¥èƒ½çœ‹åˆ°äº§å“åˆ—è¡¨äº†ï¼** ğŸ‰

