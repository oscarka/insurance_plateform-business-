# æ¥å£å®Œæ•´æµ‹è¯•æŒ‡å—

## ä¸€ã€å·²ä¿®å¤çš„æ¥å£

### 1. äº§å“ç›¸å…³æ¥å£ âœ…

#### GET /api/products
- **åŠŸèƒ½**ï¼šè·å–äº§å“åˆ—è¡¨
- **å‚æ•°**ï¼š`company_code` (å¯é€‰)
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: [...], count: ... }`
- **å‰ç«¯å¤„ç†**ï¼šè‡ªåŠ¨æå– `data` å­—æ®µè¿”å›æ•°ç»„

#### GET /api/products/:id/plans â­ æ–°å¢
- **åŠŸèƒ½**ï¼šè·å–äº§å“ä¸‹çš„æ–¹æ¡ˆåˆ—è¡¨
- **å‚æ•°**ï¼š`id` (äº§å“ID)
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: [...], count: ... }`
- **å‰ç«¯å¤„ç†**ï¼šè‡ªåŠ¨æå– `data` å­—æ®µè¿”å›æ•°ç»„

### 2. æ–¹æ¡ˆç›¸å…³æ¥å£ âœ…

#### GET /api/plans/:id
- **åŠŸèƒ½**ï¼šè·å–æ–¹æ¡ˆè¯¦æƒ…
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: {...} }`

#### GET /api/plans/:id/liabilities
- **åŠŸèƒ½**ï¼šè·å–æ–¹æ¡ˆçš„è´£ä»»é…ç½®
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: [...], count: ... }`
- **å‰ç«¯å¤„ç†**ï¼šè‡ªåŠ¨æå– `data` å­—æ®µè¿”å›æ•°ç»„

### 3. ä¿è´¹è®¡ç®—æ¥å£ âœ…

#### POST /api/premium/calculate
- **åŠŸèƒ½**ï¼šè®¡ç®—ä¿è´¹
- **è¯·æ±‚ä½“**ï¼š
  ```json
  {
    "product_id": 1,
    "plan_id": 1,
    "liability_selections": [
      { "liability_id": 1, "coverage_amount": "10ä¸‡" }
    ],
    "job_class": "1~3ç±»",
    "insured_count": 10
  }
  ```
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: { premium_per_person, total_premium, ... } }`
- **å‰ç«¯å¤„ç†**ï¼šè‡ªåŠ¨æå– `data` å­—æ®µè¿”å›å¯¹è±¡

### 4. æŠ•ä¿å•æ¥å£ âœ…

#### POST /api/applications
- **åŠŸèƒ½**ï¼šåˆ›å»ºæŠ•ä¿å•
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: { application_id, application_no, ... } }`

#### GET /api/applications/:id
- **åŠŸèƒ½**ï¼šè·å–æŠ•ä¿å•è¯¦æƒ…
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: {...} }`

#### POST /api/applications/:id/underwriting
- **åŠŸèƒ½**ï¼šæäº¤æ ¸ä¿
- **å“åº”æ ¼å¼**ï¼š`{ success: true, message: '...' }`

### 5. ä¿å¸æ¥å£ âœ…

#### GET /api/insurance-companies
- **åŠŸèƒ½**ï¼šè·å–ä¿å¸åˆ—è¡¨
- **å“åº”æ ¼å¼**ï¼š`{ success: true, data: [...], count: ... }`

---

## äºŒã€ç»Ÿä¸€çš„å“åº”æ ¼å¼å¤„ç†

### å‰ç«¯ request å‡½æ•° âœ…

æ‰€æœ‰æ¥å£çš„å“åº”éƒ½ä¼šç»Ÿä¸€å¤„ç†ï¼š
- å¦‚æœè¿”å› `{ success: true, data: [...] }`ï¼Œè‡ªåŠ¨æå– `data` å­—æ®µ
- å¦‚æœè¿”å› `{ success: true, data: {...} }`ï¼Œè‡ªåŠ¨æå– `data` å­—æ®µ
- å¦‚æœå·²ç»æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼Œç›´æ¥è¿”å›

### åç«¯å“åº”æ ¼å¼ âœ…

æ‰€æœ‰æ¥å£ç»Ÿä¸€è¿”å›ï¼š
```json
{
  "success": true,
  "data": [...],  // æˆ– {...}
  "count": ...     // å¯é€‰ï¼Œæ•°ç»„æ—¶æä¾›
}
```

---

## ä¸‰ã€æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•äº§å“åˆ—è¡¨
```bash
curl http://localhost:8888/api/products
```
åº”è¯¥è¿”å›äº§å“åˆ—è¡¨ã€‚

### 2. æµ‹è¯•äº§å“æ–¹æ¡ˆåˆ—è¡¨
```bash
curl http://localhost:8888/api/products/1/plans
```
åº”è¯¥è¿”å›äº§å“IDä¸º1çš„æ–¹æ¡ˆåˆ—è¡¨ã€‚

### 3. æµ‹è¯•æ–¹æ¡ˆè´£ä»»é…ç½®
```bash
curl http://localhost:8888/api/plans/1/liabilities
```
åº”è¯¥è¿”å›æ–¹æ¡ˆIDä¸º1çš„è´£ä»»é…ç½®ã€‚

### 4. æµ‹è¯•ä¿è´¹è®¡ç®—
```bash
curl -X POST http://localhost:8888/api/premium/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "product_id": 1,
    "plan_id": 1,
    "liability_selections": [
      {"liability_id": 1, "coverage_amount": "10ä¸‡"}
    ],
    "job_class": "1~3ç±»",
    "insured_count": 10
  }'
```
åº”è¯¥è¿”å›ä¿è´¹è®¡ç®—ç»“æœã€‚

### 5. æµ‹è¯•ä¿å¸åˆ—è¡¨
```bash
curl http://localhost:8888/api/insurance-companies
```
åº”è¯¥è¿”å›ä¿å¸åˆ—è¡¨ã€‚

---

## å››ã€å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

### 1. è·å–äº§å“åˆ—è¡¨
```typescript
import { getProducts } from './services/api';

const products = await getProducts();
// products æ˜¯æ•°ç»„ï¼Œä¸éœ€è¦å†æå– data
```

### 2. è·å–æ–¹æ¡ˆåˆ—è¡¨
```typescript
import { getPlans } from './services/api';

const plans = await getPlans(productId);
// plans æ˜¯æ•°ç»„
```

### 3. è·å–è´£ä»»é…ç½®
```typescript
import { getPlanLiabilities } from './services/api';

const liabilities = await getPlanLiabilities(planId);
// liabilities æ˜¯æ•°ç»„
```

### 4. è®¡ç®—ä¿è´¹
```typescript
import { calculatePremium } from './services/api';

const result = await calculatePremium({
  product_id: 1,
  plan_id: 1,
  liability_selections: [...],
  job_class: '1~3ç±»',
  insured_count: 10
});
// result æ˜¯å¯¹è±¡ï¼ŒåŒ…å« premium_per_person, total_premium ç­‰
```

---

## äº”ã€å·²ä¿®å¤çš„é—®é¢˜

1. âœ… **ç»Ÿä¸€å“åº”æ ¼å¼å¤„ç†**ï¼šå‰ç«¯è‡ªåŠ¨æå– `data` å­—æ®µ
2. âœ… **æ–°å¢äº§å“æ–¹æ¡ˆæ¥å£**ï¼š`GET /api/products/:id/plans`
3. âœ… **å‚æ•°æ¸…ç†**ï¼šè¿‡æ»¤æ‰ `undefined` å’Œç©ºå­—ç¬¦ä¸²å‚æ•°
4. âœ… **å­—ç¬¦é›†é…ç½®**ï¼šæ‰€æœ‰æ¥å£ä½¿ç”¨æ­£ç¡®çš„UTF-8ç¼–ç 
5. âœ… **æ—¥å¿—å¢å¼º**ï¼šæ‰€æœ‰æ¥å£éƒ½æœ‰è¯¦ç»†çš„æ—¥å¿—è®°å½•

---

## å…­ã€å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1ï¼šå¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨åç«¯
cd backend && node server.js

# å¯åŠ¨å‰ç«¯ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
cd .. && npm run dev
```

### æ­¥éª¤2ï¼šæµ‹è¯•å‰ç«¯æµç¨‹
1. æ‰“å¼€å‰ç«¯é¡µé¢ï¼šhttp://localhost:5173
2. è¿›å…¥"é€‰æ‹©æŠ•ä¿æ–¹æ¡ˆ"é¡µé¢
3. é€‰æ‹©äº§å“ â†’ åº”è¯¥æ˜¾ç¤ºæ–¹æ¡ˆåˆ—è¡¨
4. é€‰æ‹©æ–¹æ¡ˆ â†’ åº”è¯¥æ˜¾ç¤ºè´£ä»»é…ç½®
5. å¡«å†™ä¿¡æ¯ â†’ è®¡ç®—ä¿è´¹
6. æäº¤æŠ•ä¿å•

### æ­¥éª¤3ï¼šæŸ¥çœ‹æ—¥å¿—
- **åç«¯æ—¥å¿—**ï¼š`tail -f /tmp/backend.log`
- **å‰ç«¯æ§åˆ¶å°**ï¼šæµè§ˆå™¨å¼€å‘è€…å·¥å…·

---

**ç°åœ¨æ‰€æœ‰æ¥å£éƒ½å·²ç»Ÿä¸€ï¼Œå¯ä»¥å®Œæ•´æµ‹è¯•äº†ï¼** ğŸ‰

